# UI/UX仕様（MVP）

- 目的: 3参照スロット＋直前出力トグル中心の操作仕様を定義。
- 想定読者: フロント/デザイン/QA。

## 主要画面
- メインビュー: 参照スロット（3枠）/ 直前出力トグル / テキスト入力 / 生成ボタン / プレビュー / ダウンロード
- テキスト図（概略）:
  - [Slots] [Slots] [Slots]    [Toggle: 直前の出力を参照]
  - [Prompt textarea.....................................]
  - [生成する] [新しいコンセプトを開始]
  - [プレビュー: 最新出力（lastOutput）]
  - [注記: 生成画像にはAI透かし（SynthID）が含まれます]

## スロット仕様（3枠）
- 表示: サムネイル / ファイル種別（jpeg/png/webp） / サイズ / アクション（削除・ダウンロード）
- 空状態: 「ここに画像をドロップまたは選択」「対応形式: JPEG/PNG/WebP（7MB以下）」
- 設定方法:
  - ドロップ時: ドロップされたスロットに割当。スロット外にドロップ→最初の空スロットに割当。
  - ファイル選択: 「スロットを選択→選択ダイアログ」で割当。
- 満杯時: 新規割当は不可（MVP）。「スロットが満杯です。いずれかを削除してください」と通知。
- 参照データの組み立て: リクエスト時は左から順に、`references = slots.filter(Boolean).map(id => ({ uri: asset.fileUri, mime: asset.mime }))` を形成（最大3件）。重複は自動で除去。

## 直前出力トグル
- ラベル: 「直前の出力を参照」
- ON時: slot0に `lastOutput` を割当（他スロットに同一IDがあれば重複を一方のみ残す）。
- OFF時: 自動復元は行わない（PRD/Architecture準拠）。
- 注意: ONでslot0に既存画像があった場合は上書きされる（復元なし）。トグル切替時に簡易トーストで告知。

## 生成操作
- ボタン: 「生成する」
- 無効化条件: 生成中（直列化）/ バリデーションエラー時（例: 参照4件以上など）
- 成功時: プレビューに最新出力を表示、`lastOutput` 更新。トグルONの場合はslot0に反映。
- 失敗時: エラーコードに応じて日本語メッセージ表示（後述）。

## 画面状態
- 空（初期）: ガイドテキスト、非活性のダウンロード、スロットは空3枠。
- 準備完了: 0〜3枚のスロット＋プロンプト入力可能。
- 生成中: プログレス（スピナー）、ボタン非活性、スロット操作は最小化（削除のみ可）。
- 完了: プレビュー更新、最新出力のダウンロード有効化。
- エラー: 画面上部にエラー帯（dismiss可）。
- 画面離脱: beforeunloadで「再訪時はダウンロードできない」旨を警告。

## ダウンロード
- 各アセット（アップロード/生成）に「ダウンロード」を表示。
- 命名: アップロード資産は `asset.name`、生成物はサーバ返却の `downloadName` を使用。
- セッション中のみ有効（PRD準拠）。離脱時に注意表示。

## 入力検証（UI）
- 参照枚数: 0〜3（4件目の追加は弾く）。
- 形式: JPEG/PNG/WebP以外は弾く（INVALID_MIME）。
- サイズ: 7MB超は弾く（SIZE_TOO_LARGE）。
- 表示: 正方形プレビュー（UIレベルでパディング/クロップ）。原画像は変換しない。

## エラーメッセージ（例）
- RATE_LIMITED(429): 「混み合っています。しばらく待ってから再実行してください。」（`Retry-After` があれば尊重）
- INVALID_MIME(400): 「対応していない画像形式です（JPEG/PNG/WebP）。」
- SIZE_TOO_LARGE(413): 「画像サイズが大きすぎます（上限7MB）。」
- TOO_MANY_REFERENCES(400): 「参照できる画像は最大3枚です。」
- SAFETY_BLOCKED(400): 「安全ポリシーにより生成できませんでした。表現を緩和してください。」
- EXTERNAL_ERROR(502/503): 「外部サービスでエラーが発生しました。時間をおいて再実行してください。」

## アクセシビリティ（最小）
- キーボード操作可（スロット選択/削除/生成/トグル）
- フォーカス可視（Tailwindのfocusリング）
- スクリーンリーダー用ラベル（ボタン/トグル/サムネ）

## 非機能・告知
- 生成処理は同時実行1件に直列化（生成中はボタン非活性、連打抑止）。
- 生成画像にはAI透かし（SynthID）が含まれる旨をUIに告知。
- ダウンロード方針/制約はPRDの該当節に準拠。

## 完成定義（DoD）
- 本仕様に沿ってスロット/トグル/生成/ダウンロードの主要フローが破綻なく動作。
- バリデーション/文言が API Spec のエラーコードと整合。
- 直列化・離脱警告・SynthID告知が実装済み。

## 更新トリガー
- 画面構成/コンポーネント構造/エラー設計の変更。

---
関連: `./state-model.md`, `./error-handling.md`, `./mvp-prd.md`, `./api-spec.md`, `./architecture.md`
