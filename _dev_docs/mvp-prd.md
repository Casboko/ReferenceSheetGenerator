# MVPプロダクト要件（PRD）

- 目的: MVPの目的/価値/成功判定を明確化し、スコープ合意を得る。
- 想定読者: PM/開発/デザイン/QA/関係者。

## 概要 / ゴール
- 要約: 3つの参照スロット＋直前出力参照で、Gemini 2.5 Flash Image Preview を用いた画像生成/編集を反復可能にする。
- 成功の姿: 最小導線で1枚生成が安定動作し、再実行サイクルが詰まらない。

## 対象ユーザ / ユースケース
- 対象ユーザ: 画像生成を試作・検証する個人/小規模チーム。
- 主要ユースケース:
  - 参照画像を設定し、指示テキストで1枚生成。
  - 直前出力を参照に含めて再生成（反復編集）。
  - 新しいコンセプト開始時にセッションリセット。

## 機能スコープ（MVP）
- 画像アップロード（JPEG/PNG/WebP、各7MB以下、multipart→Files API登録）
- 参照スロット管理（3枠）
- 直前出力参照トグル（OFF時に復元しない）
- テキスト指示→画像1枚出力（candidateCount=1）
- エラー通知（日本語・簡易）/ ローディング表示
- アセットのダウンロード提供（同一セッション中のみ有効。アップロード資産は`asset.name`を使用、生成物はサーバ生成の`downloadName`を使用。拡張子/MIMEは応答準拠）
- 画面離脱時の注意表示（再訪時は再ダウンロード不可の旨を通知）

## 非スコープ（MVPでは扱わない）
- 複数候補/一括10枚出力のUI
- 高度なアセット管理・タグ付け
- 長期保存/履歴永続化
- 多人数同時利用/本番SLO

## 成功指標（KPI）
- 初回成功生成率 > 95%
- 1生成あたり体感待ち時間: 95p < 10秒（想定環境）
- 致命的クラッシュ/ブロッカー: ゼロ

## 非機能最小要件
- バックエンド: Vite + 最小Express(API) を併設
- セキュリティ: APIキーはサーバ側のみ保持（フロントへ露出なし）
- 画像I/O: 入力/出力ともFiles APIを使用（参照URI）
- 表示/形式: 出力は「目標=1024×1024・WebP」。現状APIで強制不可の可能性があるため、MVPではモデル既定に追従しつつUI側で正方形プレビュー（必要に応じパディング/クロップ）を適用
- 入力画像: 正方形は「推奨」（強制しない）
- ブラウザ: 最新Chromeを主サポート（Evergreen）
- 運用: 429時の自動バックオフ/再試行
 - UI: 生成処理は同時実行1件までに直列化（生成中はボタン非活性化）

## リスク（上位）と方針
- レート制限/429: バックオフ＋UIリトライ案内
- 画像サイズ超過: フロントで事前検証＋ガイド
- コスト逸脱: 出力候補数を1で固定、上限警告

## 決定事項 / 未決事項
- 決定: ステートレス設計、Files API採用、candidateCount=1固定、出力1枚固定、データのサーバ保存なし（Files 48h任せ）
- 未決: UI細部の文言/空状態のバリエーション（ui-ux-spec参照）

## ダウンロードUX方針（補足）
- Files APIは「参照用」であり、APIからファイル本体をダウンロードする機能は提供されない（48h保持 / ダウンロード不可）。
- ただしMVPでは、同一セッション中に保持しているバイト列（ユーザアップロードのFile/Blob、モデル応答の画像データ）から、各アセットの「ダウンロード」操作を提供する。
- セッションを跨いだ再ダウンロードは保証しない（ページ再訪時はバイト列を保持しないため）。画面離脱時に注意を表示する。将来は自前ストレージ導入や「エクスポート（ZIP）」機能で補完。
- 命名規則: アップロード資産は元ファイル名（`asset.name`）を用い、生成物は `generated-<ISO8601>.<ext>` 等の規則でサーバが `downloadName` を付与し返却。UIは `downloadName` をそのまま使用する。

## 完成定義（DoD）
- 上記KPIと非機能要件を満たす根拠がある
- 依存仕様が architecture/api-spec/ui-ux で確定
 - Architecture の「入力/検証（MVP）」に適合（MIME/サイズ/参照枚数/candidateCount固定の E2E が通る）

## 更新トリガー
- スコープ/KPI/主要リスクに変更が出たとき

---
関連: `./architecture.md`, `./api-spec.md`, `./ui-ux-spec.md`, `./performance-ops.md`
